<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar h1 {
            font-size: 20px;
            color: #1e3c72;
        }

        .nav-links a {
            color: #1e3c72;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: 0.3s;
            font-weight: 500;
        }

        .nav-links a:hover {
            background: #e8f0fe;
        }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px 50px;
        }

        .order-header {
            background: white;
            border-radius: 16px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .order-header h2 {
            color: #1e3c72;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .order-number {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .order-number label {
            font-weight: 600;
        }

        .order-number input {
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            width: 150px;
            font-family: inherit;
        }

        .section {
            background: white;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .section-header {
            background: #1e3c72;
            color: white;
            padding: 18px 25px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .section-header:hover {
            background: #2a5298;
        }

        .section-header .toggle {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .section.collapsed .section-header .toggle {
            transform: rotate(-90deg);
        }

        .section.collapsed .section-body {
            display: none;
        }

        .section-body {
            padding: 25px;
        }

        .field-group {
            margin-bottom: 20px;
        }

        .field-group:last-child {
            margin-bottom: 0;
        }

        .field-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .field-label .hint {
            font-weight: 400;
            color: #9ca3af;
            font-size: 12px;
        }

        .field-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .field-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .field-input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .field-input.catalog-input {
            background: #f8fafc;
        }

        .toggle-field {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-btn {
            display: flex;
            gap: 5px;
        }

        .toggle-btn button {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: 0.3s;
        }

        .toggle-btn button:first-child {
            border-radius: 8px 0 0 8px;
        }

        .toggle-btn button:last-child {
            border-radius: 0 8px 8px 0;
        }

        .toggle-btn button.active-plus {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .toggle-btn button.active-minus {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .subsection {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .subsection-title {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 15px;
        }

        textarea.field-input {
            min-height: 100px;
            resize: vertical;
        }

        .actions-bar {
            background: white;
            border-radius: 16px;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: #1e3c72;
            color: white;
        }

        .btn-primary:hover {
            background: #2a5298;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #1e3c72;
            color: #1e3c72;
        }

        .btn-outline:hover {
            background: #1e3c72;
            color: white;
        }

        .autocomplete-wrapper {
            position: relative;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
            display: none;
        }

        .autocomplete-list.active {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .autocomplete-item:hover {
            background: #f0f9ff;
        }

        .autocomplete-item .vendor {
            font-size: 12px;
            color: #6b7280;
        }

        .autocomplete-item .name {
            font-weight: 600;
        }

        .autocomplete-item .article {
            font-size: 12px;
            color: #1e40af;
        }

        .excel-row {
            display: flex;
            align-items: center;
            border-bottom: 1px solid #cbd5e1;
            padding: 4px 0;
            margin-bottom: 0px !important;
            background: white;
        }

        .excel-row:hover {
            background-color: #f8fafc;
        }

        .excel-row .field-group {
            margin-bottom: 0 !important;
            padding-right: 10px;
            border-right: 1px solid #f1f5f9;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .excel-row .field-group:last-child {
            border-right: none;
        }

        .excel-row label {
            margin-bottom: 0 !important;
            font-size: 13px;
            font-weight: 600;
            color: #334155;
        }

        .excel-subheader {
            background: #e2e8f0;
            padding: 5px 10px;
            font-weight: bold;
            font-size: 13px;
            color: #1e293b;
            border: 1px solid #cbd5e1;
            margin-top: 10px;
        }

        /* Compact Inputs for Excel Look */
        .excel-row input,
        .excel-row select {
            border: none;
            background: transparent;
            padding: 5px;
            font-size: 14px;
            height: auto;
        }

        .excel-row input:focus,
        .excel-row select:focus {
            background: #fff;
            box-shadow: inset 0 0 0 2px #3b82f6;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 10px;
            }

            .field-row {
                grid-template-columns: 1fr;
            }

            .actions-bar {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <h1>üìù –ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
        <div class="nav-links">
            <a href="index.html">üè† –ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="catalogs.html">üìö –î–æ–≤—ñ–¥–Ω–∏–∫–∏</a>
        </div>
    </nav>

    <div class="container">
        <!-- –ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
        <div class="order-header">
            <h2>–ë–ª–∞–Ω–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
            <div class="order-number">
                <label>–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</label>
                <input type="text" id="orderNumber" placeholder="‚Ññ">
                <span style="color:#6b7280">–î–∞—Ç–∞: <span id="orderDate"></span></span>
            </div>
        </div>

        <!-- DYNAMIC FORM CONTAINER -->
        <div id="form-container"></div>

    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Catalogs -->
    <!-- Dynamic Catalog Data (User Defined) -->
    <script src="data/catalogs/board_materials.js"></script>
    <script src="data/catalogs/furniture_fittings.js"></script>
    <script src="data/catalogs/appliances_plumbing.js"></script>
    <script src="data/catalogs/edges_plastics.js"></script>
    <script src="data/catalogs/countertops_panels.js"></script>
    <script src="data/catalogs/lighting.js"></script>
    <script src="data/catalogs/sliding_systems.js"></script>
    <script src="data/catalogs/services_production.js"></script>
    <script src="data/catalogs/tools_consumables.js"></script>

    <!-- Blum Hardware (Categorized) -->
    <script src="data/catalogs/blum_aventos.js"></script>
    <script src="data/catalogs/blum_tandembox.js"></script>
    <script src="data/catalogs/blum_legrabox.js"></script>
    <script src="data/catalogs/blum_movento.js"></script>
    <script src="data/catalogs/blum_hinges.js"></script>
    <script src="data/catalogs/blum_servo.js"></script>
    <script src="data/catalogs/blum_tipon.js"></script>
    <script src="data/catalogs/blum_other.js"></script>

    <!-- <script src="data/catalogs/glass_mirror.js"></script> -->
    <!-- <script src="data/catalogs/flooring.js"></script> -->

    <script>
        // Catalog Mapping (Broad Categories)
        const catalogs = {
            // Materials
            ldsp: () => window.Catalog_BoardMaterials || [],
            edges: () => window.Catalog_EdgesPlastics || [],
            postforming: () => window.Catalog_CountertopsPanels || [],

            // Hardware (All mapped to the big Furniture Fittings catalog)
            hinges: () => window.Catalog_FurnitureFittings || [],
            handles: () => window.Catalog_FurnitureFittings || [],
            drawer_systems: () => window.Catalog_FurnitureFittings || [],
            lift_systems: () => window.Catalog_FurnitureFittings || [],
            cargo: () => window.Catalog_FurnitureFittings || [],
            dryers: () => window.Catalog_FurnitureFittings || [],
            plinth: () => window.Catalog_FurnitureFittings || [],

            // Appliances
            appliances: () => window.Catalog_AppliancesPlumbing || [],
            sinks: () => window.Catalog_AppliancesPlumbing || [],
            mixers: () => window.Catalog_AppliancesPlumbing || [],

            // Lighting
            lighting: () => window.Catalog_Lighting || [],

            // Sliding Systems
            sliding: () => window.Catalog_SlidingSystems || [],

            // Blum Hardware (Categorized)
            blum_aventos: () => window.Catalog_BlumAventos || [],
            blum_tandembox: () => window.Catalog_BlumTandembox || [],
            blum_legrabox: () => window.Catalog_BlumLegrabox || [],
            blum_movento: () => window.Catalog_BlumMovento || [],
            blum_hinges: () => window.Catalog_BlumHinges || [],
            blum_servo: () => window.Catalog_BlumServo || [],
            blum_tipon: () => window.Catalog_BlumTipOn || [],
            blum_other: () => window.Catalog_BlumOther || [],

            // Fallback
            default: () => []
        };

        function getCatalog(id) {
            if (catalogs[id]) {
                return catalogs[id]();
            }
            console.warn(`Catalog ID "${id}" not found, returning empty list.`);
            return [];
        }
    </script>

    <!-- Engine & Config -->
    <script src="data/config_form.js"></script>
    <script src="core/engine.js"></script>

    <script>
        // Init Order Date
        document.getElementById('orderDate').innerText = new Date().toLocaleDateString('uk-UA');

        // Autocomplete Logic (Global Helper)
        function setupAutocomplete(inputId, listId, data) {
            const input = document.getElementById(inputId);
            const list = document.getElementById(listId);

            if (!input || !list) return; // Guard

            // Filter Element Logic (Vendor Select)
            const filterId = input.dataset.filterBy;
            let filterEl = null;
            if (filterId) {
                filterEl = document.getElementById(filterId);
                if (filterEl) {
                    filterEl.addEventListener('change', () => {
                        input.value = ''; // Clear input on vendor change
                        // Optionally trigger list update
                        const items = filterData('');
                        renderList(items);
                    });
                }
            }

            function filterData(query) {
                let sourceData = data || [];

                // 1. Filter by Vendor (if selected)
                if (filterEl && filterEl.value) {
                    const filterVal = filterEl.value.toLowerCase();
                    sourceData = sourceData.filter(item =>
                        item.vendor && item.vendor.toLowerCase().includes(filterVal)
                    );
                }

                // 2. Filter by Query
                if (!query) {
                    // If vendor is selected, return all items (limited)
                    // If no vendor and no query, return empty
                    return (filterEl && filterEl.value) ? sourceData.slice(0, 50) : [];
                }

                const lowerQuery = query.toLowerCase();
                return sourceData.filter(item =>
                    (item.name && item.name.toLowerCase().includes(lowerQuery)) ||
                    (item.article && item.article.toLowerCase().includes(lowerQuery))
                ).slice(0, 50); // Limit results
            }

            function renderList(items) {
                list.innerHTML = '';
                if (items.length === 0) {
                    list.classList.remove('active');
                    return;
                }

                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'autocomplete-item';
                    div.innerHTML = `
                        <div class="vendor">${item.vendor || '–Ü–Ω—à–∏–π'}</div>
                        <div class="name">${item.name}</div>
                        <div class="article">${item.article || ''}</div>
                    `;
                    div.onclick = () => {
                        input.value = `${item.vendor ? item.vendor + ' ' : ''}${item.name} ${item.article ? '(' + item.article + ')' : ''}`;
                        if (item.thickness) input.value += ` ${item.thickness}–º–º`;
                        list.classList.remove('active');
                    };
                    list.appendChild(div);
                });
                list.classList.add('active');
            }

            function handleInput() {
                const items = filterData(input.value);
                renderList(items);
            }

            input.addEventListener('input', handleInput);
            input.addEventListener('focus', handleInput);

            document.addEventListener('click', (e) => {
                if (wrapper && !wrapper.contains(e.target)) {
                    list.classList.remove('active');
                }
            });

            const wrapper = input.parentElement;
        }

        // Initialize Engine
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Engine && window.FormConfig) {
                window.Engine.init(window.FormConfig, 'form-container');

                // Helper to setup all autocompletes after render
                const inputs = document.querySelectorAll('.catalog-input');
                inputs.forEach(input => {
                    const catalogKey = input.dataset.catalog;
                    const varName = 'Catalog_' + window.Engine.capitalize(catalogKey);

                    if (window[varName]) {
                        setupAutocomplete(input.id, input.id + '_list', window[varName]);
                    }
                });
            } else {
                console.error('Engine or Config not loaded');
            }

            // Load Draft logic (needs to be updated for dynamic form??)
            // For now, let's just restore the basic load functionality adapted to dynamic fields
            loadDraft();
        });

        // --- OLD FUNCTIONS ADAPTED ---

        function toggleSection(id) {
            // Engine handles this natively now in createSection, but keeping for compatibility if needed
            const section = document.getElementById(id);
            if (section) section.classList.toggle('collapsed');
        }

        // --- DATA SAVING (Drafts) ---
        // We need to collect data from ALL inputs generated by Engine
        function collectFormData() {
            const data = {};
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.id) {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        data[input.id] = input.checked;
                    } else if (input.id.includes('_softclose')) { // Special handling for our custom toggles
                        const btnGroup = document.getElementById(input.id); // Wait, button group has the ID
                        // Actually our Engine assigns ID to the container div of the toggle
                        const toggleDiv = document.getElementById(input.id);
                        if (toggleDiv) data[input.id] = toggleDiv.dataset.value === 'true';
                    } else {
                        data[input.id] = input.value;
                    }
                }
                // Also check toggle divs manually since they are not inputs
                if (input.classList.contains('toggle-btn')) { // Wait, Engine implementation detail
                    data[input.id] = input.dataset.value === 'true';
                }
            });

            // Specific fix for our custom toggles
            const toggles = document.querySelectorAll('.toggle-btn');
            toggles.forEach(t => {
                data[t.id] = t.dataset.value === 'true';
            });

            return data;
        }

        function saveDraft() {
            const data = collectFormData();
            // Basic check if empty
            if (!data.orderNumber && Object.keys(data).length < 5) return;

            localStorage.setItem('order_draft', JSON.stringify(data));
            showToast('–ß–µ—Ä–Ω–µ—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
        }

        function loadDraft() {
            const saved = localStorage.getItem('order_draft');
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) {
                        if (el.tagName === 'DIV' && el.classList.contains('toggle-btn')) {
                            // It's a toggle
                            window.Engine.setToggle(key, data[key]);
                        } else if (el.type === 'checkbox') {
                            el.checked = data[key];
                        } else {
                            el.value = data[key];
                        }
                    }
                });
            }
        }

        // Auto-save
        setInterval(saveDraft, 30000);

        // --- EXPORT TO EXCEL ---
        function exportToExcel() {
            const data = collectFormData();
            let csvContent = "\uFEFF"; // BOM
            csvContent += "–ü–æ–ª–µ;–ó–Ω–∞—á–µ–Ω–Ω—è\n";

            for (const [key, value] of Object.entries(data)) {
                // Try to find label
                // This is harder with dynamic form, but we can try looking for label element
                // Or just use ID for now
                csvContent += `${key};${value}\n`;
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `order_${data.orderNumber || 'draft'}.csv`;
            link.click();
        }

        // --- PRINT ---
        function printOrder() {
            window.print();
        }

        // Toast
        function showToast(msg) {
            // Implement simple toast
            const div = document.createElement('div');
            div.textContent = msg;
            div.style.position = 'fixed';
            div.style.bottom = '20px';
            div.style.right = '20px';
            div.style.background = '#333';
            div.style.color = 'white';
            div.style.padding = '10px 20px';
            div.style.borderRadius = '5px';
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2000);
        }

    </script>

    <!-- –ö–ù–û–ü–ö–ò –î–Ü–ô -->
    <div class="actions-bar">
        <div>
            <button class="btn btn-secondary" onclick="clearForm()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn btn-outline" onclick="saveLocal()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —á–µ—Ä–Ω–µ—Ç–∫—É</button>
            <button class="btn btn-primary" onclick="exportPDF()">üìÑ PDF</button>
            <button class="btn btn-primary" onclick="exportExcel()">üìä Excel</button>
            <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫</button>
            <button class="btn btn-success" onclick="saveOrder()">‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        </div>
    </div>
    </div>

    <!-- –î–æ–≤—ñ–¥–Ω–∏–∫–∏ -->
    <script src="data/catalogs/ldsp.js"></script>
    <script src="data/catalogs/edges.js"></script>
    <script src="data/catalogs/hinges.js"></script>
    <script src="data/catalogs/handles.js"></script>
    <script src="data/catalogs/countertops.js"></script>
    <script src="data/catalogs/drawer_systems.js"></script>
    <script src="data/catalogs/lift_systems.js"></script>
    <script src="data/catalogs/cargo.js"></script>
    <script src="data/catalogs/dryers.js"></script>

    <!-- jsPDF –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <script>
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤ (moved to line 476)

        const toggleStates = {};

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', () => {
            // –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–∞—Ç—É
            document.getElementById('orderDate').textContent = new Date().toLocaleDateString('uk');

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–∫–æ–º–ø–ª—ñ—Ç
            document.querySelectorAll('.catalog-input').forEach(input => {
                setupAutocomplete(input);
            });

            // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —á–µ—Ä–Ω–µ—Ç–∫—É —è–∫—â–æ —î
            loadLocal();

            // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
            const settings = JSON.parse(localStorage.getItem('order_settings') || '{}');
            const autosaveInterval = (settings.autosaveInterval || 30) * 1000;
            if (autosaveInterval > 0) {
                setInterval(() => {
                    const data = collectFormData();
                    if (data.orderNumber || Object.values(data).some(v => v && v !== '–ë—ñ–ª–∏–π')) {
                        localStorage.setItem('order_draft', JSON.stringify(data));
                        console.log('–ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', new Date().toLocaleTimeString());
                    }
                }, autosaveInterval);
            }
        });

        function setupAutocomplete(input) {
            const listId = input.id + '_list';
            const list = document.getElementById(listId);
            const catalogName = input.dataset.catalog;

            input.addEventListener('focus', () => showSuggestions(input, list, catalogName));
            input.addEventListener('input', () => showSuggestions(input, list, catalogName));
            input.addEventListener('blur', () => {
                setTimeout(() => list.classList.remove('active'), 200);
            });
        }

        function showSuggestions(input, list, catalogName) {
            const query = input.value.toLowerCase();
            const items = catalogs[catalogName]();

            const filtered = items.filter(item =>
                item.name?.toLowerCase().includes(query) ||
                item.article?.toLowerCase().includes(query) ||
                item.vendor?.toLowerCase().includes(query)
            ).slice(0, 10);

            if (filtered.length === 0) {
                list.classList.remove('active');
                return;
            }

            list.innerHTML = filtered.map(item => `
                <div class="autocomplete-item" onclick="selectItem('${input.id}', '${item.vendor} ${item.name} ${item.article}')">
                    <div class="vendor">${item.vendor}</div>
                    <div class="name">${item.name}</div>
                    <div class="article">${item.article}</div>
                </div>
            `).join('');

            list.classList.add('active');
        }

        function selectItem(inputId, value) {
            document.getElementById(inputId).value = value;
            document.getElementById(inputId + '_list').classList.remove('active');
        }

        function toggleSection(sectionId) {
            document.getElementById(sectionId).classList.toggle('collapsed');
        }

        function setToggle(toggleId, value) {
            toggleStates[toggleId] = value;
            const container = document.getElementById(toggleId);
            const buttons = container.querySelectorAll('button');

            buttons[0].className = value ? 'active-plus' : '';
            buttons[1].className = !value ? 'active-minus' : '';
        }

        function collectFormData() {
            const data = {
                orderNumber: document.getElementById('orderNumber').value,
                date: new Date().toISOString(),
                toggleStates: { ...toggleStates }
            };

            // –ó—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ –ø–æ–ª—è
            document.querySelectorAll('.field-input').forEach(input => {
                if (input.id) {
                    data[input.id] = input.value;
                }
            });

            return data;
        }

        function saveLocal() {
            const data = collectFormData();
            localStorage.setItem('order_draft', JSON.stringify(data));
            alert('‚úÖ –ß–µ—Ä–Ω–µ—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        }

        function loadLocal() {
            const saved = localStorage.getItem('order_draft');
            if (saved) {
                const data = JSON.parse(saved);

                // –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –ø–æ–ª—è
                for (const [key, value] of Object.entries(data)) {
                    const input = document.getElementById(key);
                    if (input && typeof value === 'string') {
                        input.value = value;
                    }
                }

                // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ toggle —Å—Ç–∞–Ω–∏
                if (data.toggleStates) {
                    for (const [key, value] of Object.entries(data.toggleStates)) {
                        setToggle(key, value);
                    }
                }
            }
        }

        function clearForm() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø–æ–ª—è?')) {
                document.querySelectorAll('.field-input').forEach(input => {
                    if (input.tagName === 'SELECT') {
                        input.selectedIndex = 0;
                    } else {
                        input.value = '';
                    }
                });
                localStorage.removeItem('order_draft');
            }
        }

        function saveOrder() {
            const data = collectFormData();
            console.log('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è:', data);
            alert('‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ!\n\n(–î–ª—è –ø–æ–≤–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Firebase)');
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const orderNumber = document.getElementById('orderNumber').value || '–ë/–ù';
            const orderDate = document.getElementById('orderDate').textContent;

            // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
            let y = 20;
            const lineHeight = 7;
            const marginLeft = 15;
            const pageWidth = 195;

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.text('–ë–õ–ê–ù–ö –ó–ê–ú–û–í–õ–ï–ù–ù–Ø', 105, y, { align: 'center' });
            y += 10;

            doc.setFontSize(12);
            doc.text(`–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ ${orderNumber}`, 105, y, { align: 'center' });
            y += 7;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(`–î–∞—Ç–∞: ${orderDate}`, 105, y, { align: 'center' });
            y += 15;

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å–µ–∫—Ü—ñ–π
            function addSection(title) {
                if (y > 270) { doc.addPage(); y = 20; }
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(12);
                doc.setFillColor(30, 60, 114);
                doc.setTextColor(255, 255, 255);
                doc.rect(marginLeft, y - 5, pageWidth - 15, 8, 'F');
                doc.text(title, marginLeft + 3, y);
                doc.setTextColor(0, 0, 0);
                y += 10;
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–ª—ñ–≤
            function addField(label, fieldId, suffix = '') {
                if (y > 280) { doc.addPage(); y = 20; }
                const el = document.getElementById(fieldId);
                let value = '';
                if (el) {
                    value = el.tagName === 'SELECT' ? el.options[el.selectedIndex]?.text || '' : el.value;
                }
                if (!value || value === '‚Äî –û–±–µ—Ä—ñ—Ç—å ‚Äî') value = '-';

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.text(label + ':', marginLeft, y);
                doc.setFont('helvetica', 'normal');

                // –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏ —Ç–µ–∫—Å—Ç—É
                const maxWidth = 130;
                const textLines = doc.splitTextToSize(value + suffix, maxWidth);
                doc.text(textLines, marginLeft + 55, y);
                y += lineHeight * Math.max(1, textLines.length);
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è toggle
            function getToggle(toggleId) {
                return toggleStates[toggleId] ? '–¢–∞–∫' : '–ù—ñ';
            }

            // === –ú–ê–¢–ï–†–Ü–ê–õ–ò ===
            addSection('–ú–ê–¢–ï–†–Ü–ê–õ–ò');
            addField('–ö–æ—Ä–ø—É—Å –Ω–∏–∂–Ω—ñ—Ö', 'corpus_bottom');
            addField('–ö–æ—Ä–ø—É—Å –≤–µ—Ä—Ö–Ω—ñ—Ö', 'corpus_top');
            addField('–ö–æ—Ä–ø—É—Å –¥–æ–¥–∞—Ç–∫–æ–≤–æ', 'corpus_extra');
            addField('–ö—Ä–∞–π–∫–∞ –∫–æ—Ä–ø—É—Å–∞', 'edge_corpus');
            addField('–¢–æ–≤—â–∏–Ω–∞ –∫—Ä–∞–π–∫–∏', 'edge_corpus_thickness');
            addField('–ö—Ä–∞–π–∫–∞ —Å—Ç—ñ–ª—å–Ω–∏—Ü—ñ', 'edge_countertop');
            addField('–ö–æ–ª—ñ—Ä –î–í–ü', 'dvp_color');
            y += 5;

            // === –§–ê–°–ê–î–ò ===
            addSection('–§–ê–°–ê–î–ò');
            addField('–§–∞—Å–∞–¥ –Ω–∏–∂–Ω—ñ–π', 'facade_bottom_material');
            addField('–¢–æ–≤—â–∏–Ω–∞', 'facade_bottom_thickness');
            addField('–î–∞—Ä–±—É–≤–∞–Ω–Ω—è', 'facade_bottom_painting');
            addField('–¢–µ–∫—Å—Ç—É—Ä–∞', 'facade_bottom_texture');
            addField('–§—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è', 'facade_bottom_milling');
            y += 3;
            addField('–§–∞—Å–∞–¥ –≤–µ—Ä—Ö–Ω—ñ–π', 'facade_top_material');
            addField('–¢–æ–≤—â–∏–Ω–∞', 'facade_top_thickness');
            addField('–î–∞—Ä–±—É–≤–∞–Ω–Ω—è', 'facade_top_painting');
            addField('–¢–µ–∫—Å—Ç—É—Ä–∞', 'facade_top_texture');
            addField('–§—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è', 'facade_top_milling');
            addField('–ö—Ä–∞–π–∫–∞ —Ñ–∞—Å–∞–¥—ñ–≤', 'edge_facade');
            y += 5;

            // === –°–¢–Ü–õ–¨–ù–ò–¶–Ü ===
            addSection('–°–¢–Ü–õ–¨–ù–ò–¶–Ü –¢–ê –ü–ê–ù–ï–õ–Ü');
            addField('–°—Ç—ñ–ª—å–Ω–∏—Ü—è', 'countertop');
            addField('–¢–æ–≤—â–∏–Ω–∞', 'countertop_thickness');
            addField('–°—Ç–∏–∫', 'countertop_joint');
            addField('HPL', 'countertop_hpl');
            addField('–°—Ç—ñ–Ω–æ–≤–∞ –ø–∞–Ω–µ–ª—å', 'wall_panel');
            addField('–¢–æ–≤—â–∏–Ω–∞ –ø–∞–Ω–µ–ª—ñ', 'wall_panel_thickness');
            addField('–°–∫–ª–æ –ø–æ–ª–∏—Ü—å', 'glass_shelves');
            addField('–°–∫–ª–æ –≤—ñ—Ç—Ä–∏–Ω', 'glass_vitrines');
            addField('–î–µ–∫–æ—Ä', 'decorative');
            y += 5;

            // === –§–£–†–ù–Ü–¢–£–†–ê ===
            addSection('–§–£–†–ù–Ü–¢–£–†–ê');
            addField('–¶–æ–∫–æ–ª—å', 'plinth');
            addField('–í–∏—Å–æ—Ç–∞ —Ü–æ–∫–æ–ª—è', 'plinth_height');
            addField('–ü–æ–ª–∏—Ü–µ—Ç—Ä–∏–º–∞—á—ñ', 'shelf_supports');
            addField('–ë–æ—Ä—Ç–∏–∫', 'edging');
            addField('–ü–µ—Ç–ª—ñ', 'hinges', ' | –î–æ–≤–æ–¥—á–∏–∫: ' + getToggle('hinges_softclose'));
            addField('–í—ñ–¥–∫—Ä–∏–≤–∞–Ω–Ω—è', 'opening_system', ' | –î–æ–≤–æ–¥—á–∏–∫: ' + getToggle('opening_softclose'));
            addField('–í–∏—Å—É–≤–∞–Ω–Ω—è', 'drawer_system', ' | –î–æ–≤–æ–¥—á–∏–∫: ' + getToggle('drawer_softclose'));
            addField('–ö–æ–ª—ñ—Ä –±–æ–∫–æ–≤–∏—Ö', 'drawer_side_color');
            addField('–ü—ñ–¥–π–æ–º–Ω–∏–π –º–µ—Ö.', 'lift_system');
            addField('–ö–∞—Ä–≥–æ 1', 'cargo1', ' | –î–æ–≤–æ–¥—á–∏–∫: ' + getToggle('cargo1_softclose'));
            addField('–ö–∞—Ä–≥–æ 2', 'cargo2', ' | –î–æ–≤–æ–¥—á–∏–∫: ' + getToggle('cargo2_softclose'));
            addField('–†—É—á–∫–∏', 'handles');
            addField('–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Ä—É—á–æ–∫', 'handles_link');
            addField('TIP-ON', 'tipon');
            addField('–°—É—à–∫–∞', 'dryer');
            addField('–®–∏—Ä–∏–Ω–∞ —Å—É—à–∫–∏', 'dryer_width');
            addField('–õ–æ—Ç–æ–∫', 'tray');
            addField('–®–∏—Ä–∏–Ω–∞ –ª–æ—Ç–∫–∞', 'tray_width');
            y += 5;

            // === –ü–Ü–î–°–í–Ü–¢–ö–ê ===
            addSection('–ü–Ü–î–°–í–Ü–¢–ö–ê');
            addField('–ü—Ä–æ—Ñ—ñ–ª—å', 'light_profile');
            addField('–í–∏–º–∏–∫–∞—á', 'light_switch');
            addField('LED —Å—Ç—Ä—ñ—á–∫–∞', 'light_strip');
            addField('–†–æ–∑–º—ñ—â–µ–Ω–Ω—è', 'light_placement');
            y += 5;

            // === –¢–ï–•–ù–Ü–ö–ê ===
            addSection('–¢–ï–•–ù–Ü–ö–ê');
            addField('–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫', 'fridge');
            addField('–î—É—Ö–æ–≤–∫–∞', 'oven');
            addField('–í–∞—Ä–∏–ª—å–Ω–∞ –ø–æ–≤.', 'cooktop');
            addField('–í–∏—Ç—è–∂–∫–∞', 'hood');
            addField('–ú—ñ–∫—Ä–æ—Ö–≤–∏–ª—å–æ–≤–∞', 'microwave');
            addField('–ü–æ—Å—É–¥–æ–º–∏–π–∫–∞', 'dishwasher');
            addField('–ü—Ä–∞–ª–∫–∞', 'washer');
            addField('–î–æ–¥–∞—Ç–∫–æ–≤–æ 1', 'extra_appliance1');
            addField('–î–æ–¥–∞—Ç–∫–æ–≤–æ 2', 'extra_appliance2');
            addField('–î–æ–¥–∞—Ç–∫–æ–≤–æ 3', 'extra_appliance3');
            y += 5;

            // === –ü–†–ò–ú–Ü–¢–ö–ò ===
            addSection('–ü–†–ò–ú–Ü–¢–ö–ò');
            const notes = document.getElementById('notes')?.value || '-';
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            const noteLines = doc.splitTextToSize(notes, pageWidth - 20);
            if (y + noteLines.length * 5 > 280) { doc.addPage(); y = 20; }
            doc.text(noteLines, marginLeft, y);

            // –ó–±–µ—Ä–µ–≥—Ç–∏
            doc.save(`–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è_${orderNumber}_${orderDate.replace(/\./g, '-')}.pdf`);
        }

        function exportExcel() {
            const orderNumber = document.getElementById('orderNumber').value || '–ë-–ù';
            const orderDate = document.getElementById('orderDate').textContent;

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è toggle
            function getToggle(toggleId) {
                return toggleStates[toggleId] ? '–¢–∞–∫' : '–ù—ñ';
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—è
            function getField(fieldId) {
                const el = document.getElementById(fieldId);
                if (!el) return '';
                return el.tagName === 'SELECT'
                    ? (el.options[el.selectedIndex]?.text || '').replace('‚Äî –û–±–µ—Ä—ñ—Ç—å ‚Äî', '')
                    : el.value;
            }

            // –°—Ç–≤–æ—Ä—é—î–º–æ –¥–∞–Ω—ñ –¥–ª—è CSV
            const rows = [
                ['–ë–õ–ê–ù–ö –ó–ê–ú–û–í–õ–ï–ù–ù–Ø'],
                [''],
                ['–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è', orderNumber],
                ['–î–∞—Ç–∞', orderDate],
                [''],
                ['=== –ú–ê–¢–ï–†–Ü–ê–õ–ò ==='],
                ['–ö–æ—Ä–ø—É—Å –Ω–∏–∂–Ω—ñ—Ö', getField('corpus_bottom')],
                ['–ö–æ—Ä–ø—É—Å –≤–µ—Ä—Ö–Ω—ñ—Ö', getField('corpus_top')],
                ['–ö–æ—Ä–ø—É—Å –¥–æ–¥–∞—Ç–∫–æ–≤–æ', getField('corpus_extra')],
                ['–ö—Ä–∞–π–∫–∞ –∫–æ—Ä–ø—É—Å–∞', getField('edge_corpus')],
                ['–¢–æ–≤—â–∏–Ω–∞ –∫—Ä–∞–π–∫–∏', getField('edge_corpus_thickness')],
                ['–ö—Ä–∞–π–∫–∞ —Å—Ç—ñ–ª—å–Ω–∏—Ü—ñ', getField('edge_countertop')],
                ['–ö–æ–ª—ñ—Ä –î–í–ü', getField('dvp_color')],
                [''],
                ['=== –§–ê–°–ê–î–ò ==='],
                ['–§–∞—Å–∞–¥ –Ω–∏–∂–Ω—ñ–π', getField('facade_bottom_material')],
                ['–¢–æ–≤—â–∏–Ω–∞', getField('facade_bottom_thickness')],
                ['–î–∞—Ä–±—É–≤–∞–Ω–Ω—è', getField('facade_bottom_painting')],
                ['–¢–µ–∫—Å—Ç—É—Ä–∞', getField('facade_bottom_texture')],
                ['–§—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è', getField('facade_bottom_milling')],
                ['–§–∞—Å–∞–¥ –≤–µ—Ä—Ö–Ω—ñ–π', getField('facade_top_material')],
                ['–¢–æ–≤—â–∏–Ω–∞', getField('facade_top_thickness')],
                ['–î–∞—Ä–±—É–≤–∞–Ω–Ω—è', getField('facade_top_painting')],
                ['–¢–µ–∫—Å—Ç—É—Ä–∞', getField('facade_top_texture')],
                ['–§—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è', getField('facade_top_milling')],
                ['–ö—Ä–∞–π–∫–∞ —Ñ–∞—Å–∞–¥—ñ–≤', getField('edge_facade')],
                [''],
                ['=== –°–¢–Ü–õ–¨–ù–ò–¶–Ü ==='],
                ['–°—Ç—ñ–ª—å–Ω–∏—Ü—è', getField('countertop')],
                ['–¢–æ–≤—â–∏–Ω–∞', getField('countertop_thickness')],
                ['–°—Ç–∏–∫', getField('countertop_joint')],
                ['HPL', getField('countertop_hpl')],
                ['–°—Ç—ñ–Ω–æ–≤–∞ –ø–∞–Ω–µ–ª—å', getField('wall_panel')],
                ['–¢–æ–≤—â–∏–Ω–∞ –ø–∞–Ω–µ–ª—ñ', getField('wall_panel_thickness')],
                ['–°–∫–ª–æ –ø–æ–ª–∏—Ü—å', getField('glass_shelves')],
                ['–°–∫–ª–æ –≤—ñ—Ç—Ä–∏–Ω', getField('glass_vitrines')],
                ['–î–µ–∫–æ—Ä', getField('decorative')],
                [''],
                ['=== –§–£–†–ù–Ü–¢–£–†–ê ==='],
                ['–¶–æ–∫–æ–ª—å', getField('plinth')],
                ['–í–∏—Å–æ—Ç–∞ —Ü–æ–∫–æ–ª—è', getField('plinth_height')],
                ['–ü–æ–ª–∏—Ü–µ—Ç—Ä–∏–º–∞—á—ñ', getField('shelf_supports')],
                ['–ë–æ—Ä—Ç–∏–∫', getField('edging')],
                ['–ü–µ—Ç–ª—ñ', getField('hinges'), '–î–æ–≤–æ–¥—á–∏–∫:', getToggle('hinges_softclose')],
                ['–í—ñ–¥–∫—Ä–∏–≤–∞–Ω–Ω—è', getField('opening_system'), '–î–æ–≤–æ–¥—á–∏–∫:', getToggle('opening_softclose')],
                ['–í–∏—Å—É–≤–∞–Ω–Ω—è', getField('drawer_system'), '–î–æ–≤–æ–¥—á–∏–∫:', getToggle('drawer_softclose')],
                ['–ö–æ–ª—ñ—Ä –±–æ–∫–æ–≤–∏—Ö', getField('drawer_side_color')],
                ['–ü—ñ–¥–π–æ–º–Ω–∏–π –º–µ—Ö.', getField('lift_system')],
                ['–ö–∞—Ä–≥–æ 1', getField('cargo1'), '–î–æ–≤–æ–¥—á–∏–∫:', getToggle('cargo1_softclose')],
                ['–ö–∞—Ä–≥–æ 2', getField('cargo2'), '–î–æ–≤–æ–¥—á–∏–∫:', getToggle('cargo2_softclose')],
                ['–†—É—á–∫–∏', getField('handles')],
                ['–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Ä—É—á–æ–∫', getField('handles_link')],
                ['TIP-ON', getField('tipon')],
                ['–°—É—à–∫–∞', getField('dryer')],
                ['–®–∏—Ä–∏–Ω–∞ —Å—É—à–∫–∏', getField('dryer_width')],
                ['–õ–æ—Ç–æ–∫', getField('tray')],
                ['–®–∏—Ä–∏–Ω–∞ –ª–æ—Ç–∫–∞', getField('tray_width')],
                [''],
                ['=== –ü–Ü–î–°–í–Ü–¢–ö–ê ==='],
                ['–ü—Ä–æ—Ñ—ñ–ª—å', getField('light_profile')],
                ['–í–∏–º–∏–∫–∞—á', getField('light_switch')],
                ['LED —Å—Ç—Ä—ñ—á–∫–∞', getField('light_strip')],
                ['–†–æ–∑–º—ñ—â–µ–Ω–Ω—è', getField('light_placement')],
                [''],
                ['=== –¢–ï–•–ù–Ü–ö–ê ==='],
                ['–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫', getField('fridge')],
                ['–î—É—Ö–æ–≤–∫–∞', getField('oven')],
                ['–í–∞—Ä–∏–ª—å–Ω–∞ –ø–æ–≤.', getField('cooktop')],
                ['–í–∏—Ç—è–∂–∫–∞', getField('hood')],
                ['–ú—ñ–∫—Ä–æ—Ö–≤–∏–ª—å–æ–≤–∞', getField('microwave')],
                ['–ü–æ—Å—É–¥–æ–º–∏–π–∫–∞', getField('dishwasher')],
                ['–ü—Ä–∞–ª–∫–∞', getField('washer')],
                ['–î–æ–¥–∞—Ç–∫–æ–≤–æ 1', getField('extra_appliance1')],
                ['–î–æ–¥–∞—Ç–∫–æ–≤–æ 2', getField('extra_appliance2')],
                ['–î–æ–¥–∞—Ç–∫–æ–≤–æ 3', getField('extra_appliance3')],
                [''],
                ['=== –ü–†–ò–ú–Ü–¢–ö–ò ==='],
                [getField('notes')]
            ];

            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≤ CSV
            const csvContent = rows.map(row =>
                row.map(cell => `"${(cell || '').replace(/"/g, '""')}"`).join(';')
            ).join('\n');

            // –î–æ–¥–∞—î–º–æ BOM –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–∏—Ä–∏–ª–∏—Ü—ñ –≤ Excel
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è_${orderNumber}_${orderDate.replace(/\./g, '-')}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>

</html>